"use strict";const ELEMENT_PREFIX="element-",ELEMENT_OBSERVER=ELEMENT_PREFIX+"observer",ELEMENT_COLLECT=ELEMENT_PREFIX+"collect",ELEMENT_MASTER=ELEMENT_PREFIX+"master";function root(e){return e.shadowRoot||e}function remove(e,t){root(e).removeChild(t)}function append(e,t){root(e).appendChild(t)}function replace(e,t,o){root(e).replaceChild(t,o)}function h(e,t,...o){return new VDom(e,t,concat(o))}class VDom{constructor(e,t,o){this.tag=e,this.props=t||{},this.children=o||[],this.collect=this.props[ELEMENT_COLLECT]||!1}emit(e,t){let o=this.props[ELEMENT_OBSERVER];"function"==typeof o&&o(e,t)}clone(e=this.tag,t=this.props,o=this.children){return new VDom(e,t,o)}}function isDom(e){return null!==e&&"object"==typeof e&&11!==e.nodeType}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t=[]){for(let o=0;o<e.length;o++){let n=e[o];Array.isArray(n)?concat(n,t):t.push(isVDom(n)?n:new VDom("",{},[n||""]))}return t}function diff(e,t,o,n={},i){let r=t&&t[ELEMENT_MASTER]||new VDom,l=t,E=o;if(o){let E="slot"===o.tag;if(o=slot(o,n),r=slot(r,n),i=i||"svg"===o.tag,e&&r.tag!==o.tag)if(l=isDom(o.tag)?o.tag:o.tag?i?document.createElementNS("http://www.w3.org/2000/svg",o.tag):document.createElement(o.tag):document.createTextNode(""),t)for(replace(e,l,t);!E&&!o.collect&&t.firstChild;)append(l,t.firstChild);else append(e,l);if(3===l.nodeType)r.children[0]!==o.children[0]&&(l.textContent=o.children[0]);else{let t=diffProps(l,o.tag===r.tag?r.props:{},o.props,i,o.collect,e&&o.collect);if(o.collect)t.children=o.children.map(e=>e.tag?e:e.children[0]),o.emit(ELEMENT_COLLECT,t);else if(!E&&l){let e=Array.from(l.childNodes),t=Math.max(e.length,o.children.length);for(let r=0;r<t;r++)diff(l,e[r],o.children[r],n,i)}}}else e&&t&&remove(e,t);return l[ELEMENT_MASTER]=E,l}function diffProps(e,t,o,n,i,r){let l=Object.keys(t).concat(Object.keys(o)),E=l.length,c={};for(let s=0;s<E;s++){let E=l[s];if(E.indexOf(ELEMENT_PREFIX)&&(!n||"xmlns"!==E)&&t[E]!==o[E]){if(i&&i.indexOf(E)>-1){c[E]=o[E];continue}let l="function"==typeof o[E],s="function"==typeof t[E];if(l||s)s&&e.removeEventListener(E,t[E]),l&&e.addEventListener(E,o[E]);else if(E in o)if(E in e&&!n||n&&"style"===E)if("style"===E)if("object"==typeof o[E]){let n=t[E]||{},i=o[E];for(let t in i)n[t]!==i[t]&&("-"===t[0]?e.setProperty(t,i[t]):e.style[t]=i[t]);o[E]={...n,...i}}else e.style.cssText=o[E];else e[E]=o[E];else n?e.setAttributeNS(null,E,o[E]):e.setAttribute(E,o[E]);else r?o[E]=t[E]:e.removeAttribute(E)}}return c}function slot(e,t){return"slot"===e.tag?e.clone(t[e.props.name]||""):e}var index={diff:diff,h:h,ELEMENT_COLLECT:ELEMENT_COLLECT,ELEMENT_OBSERVER:ELEMENT_OBSERVER};module.exports=index;
//# sourceMappingURL=atomico-diff.js.map
